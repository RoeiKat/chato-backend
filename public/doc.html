<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chato API Docs</title>
  <style>
    :root { --bg:#0b0c10; --card:#111318; --text:#e6e6e6; --muted:#a8b0bd; --line:#252a33; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    p { margin: 0 0 14px; color: var(--muted); line-height: 1.5; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 10px; padding: 16px; margin: 14px 0; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    pre { background: #0e1116; border: 1px solid var(--line); border-radius: 10px; padding: 12px; overflow:auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { text-align: left; padding: 10px 10px; border-bottom: 1px solid var(--line); vertical-align: top; }
    th { color: var(--muted); font-weight: 600; }
    .tag { display:inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--line); margin-right: 6px; }
    .get { background: rgba(0, 170, 255, 0.12); }
    .post { background: rgba(0, 255, 153, 0.10); }
    .patch { background: rgba(255, 140, 0, 0.10); }
    .del { background: rgba(255, 89, 100, 0.12); }
    .auth { background: rgba(255, 204, 0, 0.10); }
    .small { font-size: 13px; color: var(--muted); }
    a { color: #8cc8ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .hr { height:1px; background: var(--line); margin: 12px 0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Chato API Documentation</h1>
    <p>REST API for: owner auth + dashboard, app (API key) management, SDK messaging + config, and owner utilities (shifts + reminders).</p>

    <div class="card">
      <div class="small"><b>Auth</b>:</div>
      <div class="small">• Dashboard / Apps: <code>Authorization: Bearer &lt;jwt&gt;</code></div>
      <div class="small">• SDK: <code>x-api-key: &lt;apiKey&gt;</code></div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Health</h2>
      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag get">GET</span></td>
            <td><code>/health</code></td>
            <td>Basic health check (for hosting probes).</td>
          </tr>
        </tbody>
      </table>
      <pre><code>curl http://localhost:3000/health</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Authentication (Owner / Dashboard)</h2>
      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Body</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/auth/register</code></td>
            <td>Create owner account. Returns JWT.</td>
            <td><code>{ "email": "a@a.com", "password": "123456" }</code></td>
          </tr>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/auth/login</code></td>
            <td>Login owner. Returns JWT.</td>
            <td><code>{ "email": "a@a.com", "password": "123456" }</code></td>
          </tr>
        </tbody>
      </table>

      <pre><code># Register
curl -X POST http://localhost:3000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"a@a.com","password":"123456"}'

# Login
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"a@a.com","password":"123456"}'
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Apps (Owner / Dashboard)</h2>
      <p class="small">Owner creates apps and receives an <code>apiKey</code> to embed in the Android app. Apps can also be listed, deleted, and configured (pre-chat + theme).</p>

      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Auth</th><th>Body / Notes</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/apps</code></td>
            <td>Create new app (returns <code>apiKey</code>).</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td><code>{ "name": "My App" }</code></td>
          </tr>
          <tr>
            <td><span class="tag get">GET</span></td>
            <td><code>/apps</code></td>
            <td>List all apps for the authenticated owner.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td class="small">Sorted by newest first.</td>
          </tr>
          <tr>
            <td><span class="tag del">DELETE</span></td>
            <td><code>/apps/&lt;apiKey&gt;</code></td>
            <td>Delete an app (also removes its sessions + messages).</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td class="small">Path param: <span class="mono">apiKey</span></td>
          </tr>
          <tr>
            <td><span class="tag patch">PATCH</span></td>
            <td><code>/apps/&lt;apiKey&gt;/settings</code></td>
            <td>Update app <code>prechat</code> and/or <code>theme</code> settings.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td>
              <div class="small">Send any subset of fields; omitted fields are unchanged.</div>
              <code>{
  "prechat": { "q1": "...", "q2": "...", "q3": "...", "faqUrl": "..." },
  "theme":  { "bubbleBg": "#...", "primary": "#...", "iconSvg": "&lt;svg...&gt;", "title": "Support" }
}</code>
            </td>
          </tr>
        </tbody>
      </table>

      <pre><code># Create app
curl -X POST http://localhost:3000/apps \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{"name":"My App"}'

# List apps
curl http://localhost:3000/apps \
  -H "Authorization: Bearer &lt;JWT&gt;"

# Update settings (example)
curl -X PATCH http://localhost:3000/apps/&lt;API_KEY&gt;/settings \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{
    "prechat": { "q1":"Tip1", "q2":"Tip2", "q3":"Tip3", "faqUrl":"" },
    "theme": { "bubbleBg":"#1C1C1C", "primary":"#FFE95C", "title":"Support" }
  }'

# Delete app
curl -X DELETE http://localhost:3000/apps/&lt;API_KEY&gt; \
  -H "Authorization: Bearer &lt;JWT&gt;"
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">SDK (Android App)</h2>
      <p class="small">
        The Android SDK uses <code>x-api-key</code>. It can fetch the app configuration (pre-chat + theme),
        and send messages. If <code>sessionId</code> is missing, a session is created automatically and returned.
      </p>

      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Auth</th><th>Body / Notes</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag get">GET</span></td>
            <td><code>/sdk/config</code></td>
            <td>Get SDK config for this <code>apiKey</code> (app name, prechat, theme).</td>
            <td><span class="tag auth">x-api-key</span></td>
            <td class="small">No body.</td>
          </tr>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/sdk/message</code></td>
            <td>Send a message. Auto-creates session if needed. Returns <code>sessionId</code>.</td>
            <td><span class="tag auth">x-api-key</span></td>
            <td>
              <div class="small"><code>from</code> is normalized to either <code>customer</code> or <code>owner</code> on the backend.</div>
              <code>{ "text": "Hi", "sessionId": "optional", "from": "customer|owner|bot|agent|support" }</code>
            </td>
          </tr>
        </tbody>
      </table>

      <pre><code># Get SDK config
curl http://localhost:3000/sdk/config \
  -H "x-api-key: &lt;API_KEY&gt;"

# Send first message (creates session)
curl -X POST http://localhost:3000/sdk/message \
  -H "x-api-key: &lt;API_KEY&gt;" \
  -H "Content-Type: application/json" \
  -d '{"text":"Hello from Android","from":"customer"}'

# Send next message (reuse sessionId)
curl -X POST http://localhost:3000/sdk/message \
  -H "x-api-key: &lt;API_KEY&gt;" \
  -H "Content-Type: application/json" \
  -d '{"text":"Second message","sessionId":"&lt;SESSION_ID&gt;","from":"customer"}'
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Dashboard Messaging (Owner)</h2>
      <p class="small">Owner replies to a session and can mark it as read (resets <code>unreadOwner</code>).</p>

      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Auth</th><th>Body</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/dashboard/message</code></td>
            <td>Reply to a customer in a session.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td><code>{ "apiKey":"...", "sessionId":"...", "text":"How can I help?" }</code></td>
          </tr>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/dashboard/session/read</code></td>
            <td>Mark a session as read (sets <code>unreadOwner</code> to 0 and stores <code>ownerLastReadAt</code>).</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td><code>{ "apiKey":"...", "sessionId":"..." }</code></td>
          </tr>
        </tbody>
      </table>

      <pre><code># Reply
curl -X POST http://localhost:3000/dashboard/message \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{"apiKey":"&lt;API_KEY&gt;","sessionId":"&lt;SESSION_ID&gt;","text":"How can I help?"}'

# Mark session read
curl -X POST http://localhost:3000/dashboard/session/read \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{"apiKey":"&lt;API_KEY&gt;","sessionId":"&lt;SESSION_ID&gt;"}'
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Shifts (Owner)</h2>
      <p class="small">Track work shifts for the authenticated owner.</p>

      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Auth</th><th>Body / Query</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/dashboard/shifts</code></td>
            <td>Create a shift.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td><code>{ "startedAt": 1700000000000, "endedAt": 1700003600000, "durationMs": 3600000 }</code></td>
          </tr>
          <tr>
            <td><span class="tag get">GET</span></td>
            <td><code>/dashboard/shifts</code></td>
            <td>List shifts for a week.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td class="small"><code>?weekStart=&lt;ms&gt;</code> optional (defaults to current week start).</td>
          </tr>
        </tbody>
      </table>

      <pre><code># Create shift
curl -X POST http://localhost:3000/dashboard/shifts \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{"startedAt":1700000000000,"endedAt":1700003600000,"durationMs":3600000}'

# List shifts (optional weekStart)
curl "http://localhost:3000/dashboard/shifts?weekStart=1700000000000" \
  -H "Authorization: Bearer &lt;JWT&gt;"
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Reminders (Owner)</h2>
      <p class="small">Simple reminders list for the authenticated owner.</p>

      <table>
        <thead>
          <tr><th>Method</th><th>Path</th><th>Description</th><th>Auth</th><th>Body / Notes</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="tag get">GET</span></td>
            <td><code>/dashboard/reminders</code></td>
            <td>List reminders.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td class="small">Returns newest first.</td>
          </tr>
          <tr>
            <td><span class="tag post">POST</span></td>
            <td><code>/dashboard/reminders</code></td>
            <td>Create a reminder.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td><code>{ "text": "Call customer back" }</code></td>
          </tr>
          <tr>
            <td><span class="tag del">DELETE</span></td>
            <td><code>/dashboard/reminders/&lt;id&gt;</code></td>
            <td>Delete a reminder by id.</td>
            <td><span class="tag auth">Bearer JWT</span></td>
            <td class="small">Path param: <span class="mono">id</span></td>
          </tr>
        </tbody>
      </table>

      <pre><code># List reminders
curl http://localhost:3000/dashboard/reminders \
  -H "Authorization: Bearer &lt;JWT&gt;"

# Create reminder
curl -X POST http://localhost:3000/dashboard/reminders \
  -H "Authorization: Bearer &lt;JWT&gt;" \
  -H "Content-Type: application/json" \
  -d '{"text":"Call customer back"}'

# Delete reminder
curl -X DELETE http://localhost:3000/dashboard/reminders/&lt;REMINDER_ID&gt; \
  -H "Authorization: Bearer &lt;JWT&gt;"
</code></pre>
    </div>

    <div class="card">
      <h2 style="margin:0 0 6px;">Realtime DB Data Layout</h2>
      <pre><code>apps/{apiKey}
users/{userId}
emailToUid/{encodedEmail}
sessions/{apiKey}/{sessionId}
messages/{apiKey}/{sessionId}/{messageId}
owners/{ownerId}/shifts/{shiftId}
owners/{ownerId}/reminders/{reminderId}</code></pre>
      <p class="small">Messages are append-only; sessions store metadata like last message, timestamps, and unread counters.</p>
    </div>

  </div>
</body>
</html>
